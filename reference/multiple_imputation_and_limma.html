<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Run multiple imputation and limma — multiple_imputation_and_limma • mavis</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Run multiple imputation and limma — multiple_imputation_and_limma"><meta property="og:description" content="This function is an efficient wrapper that fits the needed gamma regressions,
performs multiple imputation and testing with limma (see limmaUsersGuide).
It is an efficient wrapper that generates need inputs for imputation and
running run_limma with the possibility of using
multidplyr-package to paralellize the computation.
It also calls produces the mean-variance trends if plot_trend is TRUE."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mavis</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/baldur-tutorial.html">Baldur-Tutorial</a>
    </li>
    <li>
      <a href="../articles/ensemble.html">Ensemble Tutorial</a>
    </li>
    <li>
      <a href="../articles/mult-imp.html">Multiple Imputation and limma</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Run multiple imputation and limma</h1>

    <div class="hidden name"><code>multiple_imputation_and_limma.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function is an efficient wrapper that fits the needed gamma regressions,
performs multiple imputation and testing with limma (see <code><a href="https://rdrr.io/pkg/limma/man/limmaUsersGuide.html" class="external-link">limmaUsersGuide</a></code>).
It is an efficient wrapper that generates need inputs for imputation and
running <code><a href="run_limma.html">run_limma</a></code> with the possibility of using
<code><a href="https://multidplyr.tidyverse.org/reference/multidplyr-package.html" class="external-link">multidplyr-package</a></code> to paralellize the computation.
It also calls produces the mean-variance trends if <code>plot_trend</code> is <code>TRUE</code>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">multiple_imputation_and_limma</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">design</span>,</span>
<span>  <span class="va">contrast_matrix</span>,</span>
<span>  <span class="va">imputations</span>,</span>
<span>  workers <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  id_col <span class="op">=</span> <span class="st">"id"</span>,</span>
<span>  .robust <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  plot_trend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  formula_imputation <span class="op">=</span> <span class="va">sd_p</span> <span class="op">~</span> <span class="va">mean</span>,</span>
<span>  formula_weights <span class="op">=</span> <span class="va">sd</span> <span class="op">~</span> <span class="va">mean</span>,</span>
<span>  imp_pars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>The data to run the pipeline on, missing values should have NA
values.</p></dd>


<dt id="arg-design">design<a class="anchor" aria-label="anchor" href="#arg-design"></a></dt>
<dd><p>A design matrix as produced by <code><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></code>.</p></dd>


<dt id="arg-contrast-matrix">contrast_matrix<a class="anchor" aria-label="anchor" href="#arg-contrast-matrix"></a></dt>
<dd><p>A contrast matrix of comparisons to perfrom see
<code><a href="https://rdrr.io/pkg/limma/man/makeContrasts.html" class="external-link">makeContrasts</a></code> for details.</p></dd>


<dt id="arg-imputations">imputations<a class="anchor" aria-label="anchor" href="#arg-imputations"></a></dt>
<dd><p>Number of imputations to perfrome.</p></dd>


<dt id="arg-workers">workers<a class="anchor" aria-label="anchor" href="#arg-workers"></a></dt>
<dd><p>Number of workers (processes) to run the pipeline with.
Any value &gt;1 will run the pipeline with parallel computing using the
<code><a href="https://multidplyr.tidyverse.org/reference/multidplyr-package.html" class="external-link">multidplyr-package</a></code>.</p></dd>


<dt id="arg-id-col">id_col<a class="anchor" aria-label="anchor" href="#arg-id-col"></a></dt>
<dd><p>A character for the name of the column containing the
name of the features in data (e.g., peptides, proteins, etc.).</p></dd>


<dt id="arg--robust">.robust<a class="anchor" aria-label="anchor" href="#arg--robust"></a></dt>
<dd><p>Input to limma robust option</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>logical value if weights should be used.</p></dd>


<dt id="arg-plot-trend">plot_trend<a class="anchor" aria-label="anchor" href="#arg-plot-trend"></a></dt>
<dd><p>Should the mean-variance trend with the gamma regression be
plotted?</p></dd>


<dt id="arg-formula-imputation">formula_imputation<a class="anchor" aria-label="anchor" href="#arg-formula-imputation"></a></dt>
<dd><p>Formula for the regression model used for imputation</p></dd>


<dt id="arg-formula-weights">formula_weights<a class="anchor" aria-label="anchor" href="#arg-formula-weights"></a></dt>
<dd><p>Formula for the regression model used for weights</p></dd>


<dt id="arg-imp-pars">imp_pars<a class="anchor" aria-label="anchor" href="#arg-imp-pars"></a></dt>
<dd><p>Imputation parameters to use; as inferred by <a href="imp.html">get_imputation_pars</a>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments to <code><a href="multi_trend_partitioning.html">multi_trend_partitioning</a></code></p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A tibble with each imputation as a row. The first column contains the
imputation number, the second contains the imputed data, and the last
column contains the results produced by <code><a href="run_limma.html">run_limma</a></code>.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Generate a design matrix for the data</span></span></span>
<span class="r-in"><span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set correct colnames, this is important.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">design</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"ng"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generate the contrast matrix</span></span></span>
<span class="r-in"><span><span class="va">contrast</span> <span class="op">&lt;-</span> <span class="fu">limma</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/limma/man/makeContrasts.html" class="external-link">makeContrasts</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  contrasts <span class="op">=</span> <span class="st">"ng100-ng50"</span>,</span></span>
<span class="r-in"><span>  levels <span class="op">=</span> <span class="va">design</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Normalize and log-transform the data</span></span></span>
<span class="r-in"><span><span class="va">yeast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/baldur/man/psrn.html" class="external-link">psrn</a></span><span class="op">(</span><span class="va">yeast</span>, <span class="st">"identifier"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">multiple_imputation_and_limma</span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">yeast</span>,</span></span>
<span class="r-in"><span>  <span class="va">design</span>,</span></span>
<span class="r-in"><span>  <span class="va">contrast</span>,</span></span>
<span class="r-in"><span>  <span class="fl">10</span>, <span class="co"># Just running 10 imputation for the example purpose, but can be large &gt; 1000</span></span></span>
<span class="r-in"><span>  <span class="fl">1</span>,  <span class="co"># Number of parallel workers to use (will drastically increase the speed)</span></span></span>
<span class="r-in"><span>  <span class="st">"identifier"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Estimating Imputation Paramters</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Previous error: Inf 	&gt;	Current error: 0.9295734 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iteration time:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7.172695 secs </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Previous error: 0.9295734 	&gt;	Current error: 0.02261715 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iteration time:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7.52854 secs </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Previous error: 0.02261715 	&gt;	Current error: 0.008648534 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iteration time:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7.308468 secs </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Previous error: 0.008648534 	&gt;	Current error: 0.004244227 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iteration time:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7.287357 secs </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Previous error: 0.004244227 	&gt;	Current error: 0.002974494 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iteration time:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7.354982 secs </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Previous error: 0.002974494 	&gt;	Current error: 0.001724345 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iteration time:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7.307193 secs </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Previous error: 0.001724345 	&lt;	Current error: 0.001800116 	Breaking </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iteration time:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  7.322003 secs </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Philip Berg.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

