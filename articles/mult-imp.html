<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Multiple Imputation and limma • mavis</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Multiple Imputation and limma">
<meta property="og:description" content="mavis">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mavis</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/baldur-tutorial.html">Baldur-Tutorial</a>
    </li>
    <li>
      <a href="../articles/ensemble.html">Ensemble Tutorial</a>
    </li>
    <li>
      <a href="../articles/mult-imp.html">Multiple Imputation and limma</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Multiple Imputation and limma</h1>
                        <h4 data-toc-skip class="author">Philip
Berg</h4>
            
      
      
      <div class="hidden name"><code>mult-imp.Rmd</code></div>

    </div>

    
    
<p>First we load the package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mavis</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="datasets-included-in-mavis">Datasets included in <code>mavis</code><a class="anchor" aria-label="anchor" href="#datasets-included-in-mavis"></a>
</h3>
<p><code>mavis</code> comes with two of the published data sets,
<code>yeast</code> and <code>ups</code>, published in <span class="citation">@berg2019evaluation</span> (details can be found there;
please cite accordingly if you use these data in your work). Both
datasets are quantified with Progenesis. The <code>ups</code> data sets
is a global proteomics dataset without reducing peptides to proteins
with either <em>Chlamydomonas reinhardtii</em> (chlamy) peptides with
the same concentration in all samples. The <code>ups</code> is spiked-in
with three different concentrations of the Universal Proteomics Standard
Set 1 (UPS1) with four replicates each. The <code>yeast</code> data was
generated by extracting reversibly oxidized cysteines in
<em>Saccharomyces cerevisiae</em> or chlamy where the yeast extraction
was added in two different concentrations and chlamy in the same in all
samples. The <code>yeast</code> data is therefore a lot noisier than the
<code>ups</code> data. The yeast data looks as follows:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yeast</span></span>
<span><span class="co">#&gt; # A tibble: 2,235 × 7</span></span>
<span><span class="co">#&gt;    identifier                               ng50_1 ng50_2 ng50_3 ng100_1 ng100_2 ng100_3</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                                     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 Cre01.g000450.t1.2|PACid:30788617|--321   77.4    78.1   76.4    11.3    5.99    NA  </span></span>
<span><span class="co">#&gt;  2 Cre01.g000800.t1.2|PACid:30788536|--66   247.    255.   245.    225.   227.     231. </span></span>
<span><span class="co">#&gt;  3 Cre01.g002050.t1.1|PACid:30789101|--408   60.1    43.2   69.9   133.   113.     118. </span></span>
<span><span class="co">#&gt;  4 Cre01.g002300.t1.2|PACid:30788660|--168   90.8    74.9   55.1    96.8   90.1     76.7</span></span>
<span><span class="co">#&gt;  5 Cre01.g002300.t1.2|PACid:30788660|--40   932.   1096.   925.   1179.  1377.    1335. </span></span>
<span><span class="co">#&gt;  6 Cre01.g002300.t1.2|PACid:30788660|--69   537.    469.   369.   1106.  1127.    1099. </span></span>
<span><span class="co">#&gt;  7 Cre01.g004350.t1.2|PACid:30788641|--148   90.6   110.    70.6   119.    94.5     81.0</span></span>
<span><span class="co">#&gt;  8 Cre01.g004500.t1.2|PACid:30789545|--270    3.56   NA     NA      99.0  111.      81.0</span></span>
<span><span class="co">#&gt;  9 Cre01.g004500.t1.2|PACid:30789545|--355 4376.   4311.  3952.   3901.  3643.    3697. </span></span>
<span><span class="co">#&gt; 10 Cre01.g004500.t1.2|PACid:30789545|--402  271.    123.    32.0   787.   799.     785. </span></span>
<span><span class="co">#&gt; # ℹ 2,225 more rows</span></span></code></pre></div>
<p>where the <code>identifier</code> is a column that uniquely maps each
cysteine to the observations in <code>ng50_*</code> or
<code>ng100_*</code> (which are the relative concentrations the yeast
cysteines were spiked in with) and the integer at the end indicates
different repeated experiments. The ups data looks as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ups</span></span>
<span><span class="co">#&gt; # A tibble: 10,599 × 13</span></span>
<span><span class="co">#&gt;    identifier                                                        fmol25_1 fmol25_2 fmol25_3 fmol25_4 fmol50_1 fmol50_2 fmol50_3 fmol50_4 fmol100_1 fmol100_2 fmol100_3 fmol100_4</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                                                                &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 Cre01.g000350.t1.1|PACid:30788481|--AVLLFATGSGISPLR                 695.     674.      689.     694.     741.     739.     733.     796.      644.      675.      715.      735. </span></span>
<span><span class="co">#&gt;  2 Cre01.g000350.t1.1|PACid:30788481|--GFALDRLPASTTR                   736.     636.      657.     608.     793.     783.     694.     734.      654.      642.      619.      613. </span></span>
<span><span class="co">#&gt;  3 Cre01.g000350.t1.1|PACid:30788481|--VVIDVGAPLAAGYTVPGQFVQVK         681.     727.      638.     647.     732.     726.     654.     661.      628.      694.      607.      684. </span></span>
<span><span class="co">#&gt;  4 Cre01.g000350.t1.1|PACid:30788481|--VVSVYSESK                       491.     448.      463.     444.     372.     408.     408.     475.      413.      389.      476.      433. </span></span>
<span><span class="co">#&gt;  5 Cre01.g000900.t1.2|PACid:30788866|--ALGPATATLPTYGVGHGLGSLIQLLICAR     7.90     1.19     NA       26.9     NA       33.4     NA       NA        NA        NA        NA        NA  </span></span>
<span><span class="co">#&gt;  6 Cre01.g000900.t1.2|PACid:30788866|--LAAGAVESTGGALGR                 106.      82.6     102.      96.6     84.3     97.3     93.1     90.0      91.2      91.2      86.6     108. </span></span>
<span><span class="co">#&gt;  7 Cre01.g000900.t1.2|PACid:30788866|--TPSAVAHFLGEAFVGAAPQMAYR          39.3     64.5      15.3     60.2     31.0     29.2     38.5     57.6      35.5      51.0      41.1      47.7</span></span>
<span><span class="co">#&gt;  8 Cre01.g001100.t1.2|PACid:30788546|--AAANQDPAELEAANPVASWLSR          694.     664.      530.     453.     617.     566.     518.     275.      581.      513.      488.      449. </span></span>
<span><span class="co">#&gt;  9 Cre01.g001100.t1.2|PACid:30788546|--APAANGGAAATPAPAAAAPAPRPAAPAR    525.     601.      673.     618.     631.     509.     669.     593.      530.      626.      635.      680. </span></span>
<span><span class="co">#&gt; 10 Cre01.g001100.t1.2|PACid:30788546|--APSGVLGACLR                     743.     671.      680.     636.     664.     667.     687.     649.      679.      624.      762.      689. </span></span>
<span><span class="co">#&gt; # ℹ 10,589 more rows</span></span></code></pre></div>
<p>where the <code>identifier</code> is as in the yeast dataset but
uniquely maps peptides and <code>fmol25_*</code>, <code>fmol50_*</code>,
and <code>fmol100_*</code> are different relative concentrations of UPS1
with different technical replicates.</p>
</div>
<div class="section level3">
<h3 id="data-normalization">Data normalization<a class="anchor" aria-label="anchor" href="#data-normalization"></a>
</h3>
<p>The first step is to normalize the data. The function
<code>plot_norm_box</code> generates boxplots of the raw data after
log<span class="math inline">\(_{2}\)</span> transformation and two
different normalization methods. If we first look at the yeast data,
then the plot can be generated as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_norm_box.html">plot_norm_box</a></span><span class="op">(</span><span class="va">yeast</span>, <span class="st">'identifier'</span><span class="op">)</span></span></code></pre></div>
<p><img src="norm_vis_yeast-1.png" alt="plot of chunk norm_vis_yeast">
The data is already has a stable median, but we still do normalization.
This can either be done <code>tmm</code> as introduced in <span class="citation">@robinson2010scaling</span> or with <code>psrn</code>
as introduced in <span class="citation">@anders2010differential</span>.
To exemplify we use <code>psrn</code> and <code>tmm</code> as
follows:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yeast_psrn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/baldur/man/psrn.html" class="external-link">psrn</a></span><span class="op">(</span><span class="va">yeast</span>, <span class="st">'identifier'</span><span class="op">)</span></span>
<span><span class="va">yeast_tmm</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tmm.html">tmm</a></span><span class="op">(</span><span class="va">yeast</span><span class="op">)</span></span></code></pre></div>
<p>Both <code>psrn</code> and <code>tmm</code> first normalizes the data
and then log<span class="math inline">\(_{2}\)</span> transforms it
unless the flag <code>log=FALSE</code> is used. For the <code>ups</code>
data we do the same thing:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_norm_box.html">plot_norm_box</a></span><span class="op">(</span><span class="va">ups</span>, <span class="st">'identifier'</span><span class="op">)</span></span></code></pre></div>
<p><img src="norm_vis_ups-1.png" alt="plot of chunk norm_vis_ups"> we
might notice that the x-axis labels are overlapping. Since
<code>plot_norm_box</code> returns a <code>ggplot</code> object, one can
easily rotate the label by using the <code>+</code> syntax and
<code><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">ggplot2::theme</a></code> as follows:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_norm_box.html">plot_norm_box</a></span><span class="op">(</span><span class="va">ups</span>, <span class="st">'identifier'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.text.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="norm_vis_ups_ang-1.png" alt="plot of chunk norm_vis_ups_ang"> in this way, any theme of the
plot can easily be modified using <code>ggplot2</code> syntax. One could
also use the <code>plot_target</code> feature of
<code>plot_norm_box</code> to select only a subset of samples to
plot:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_norm_box.html">plot_norm_box</a></span><span class="op">(</span><span class="va">ups</span>, <span class="st">'identifier'</span>, plot_target <span class="op">=</span> <span class="fu">contains</span><span class="op">(</span><span class="st">'fmol25'</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="norm_vis_ups_sub-1.png" alt="plot of chunk norm_vis_ups_sub"> which supports the
<code>tidyselect</code> package operations for selecting columns.
Likewise, <code>tmm</code> and <code>psrn</code> have the flag
<code>target</code> which can be used to select only a subset of columns
to normalize. If left unspecified they will use all numerical columns in
the normalization! They also contain the flag <code>load_info</code>
which then makes the functions return a list with the normalized data,
the estimated loading concentrations, and the estimated normalization
factors used. We then normalize the <code>ups</code> the same way as the
<code>yeast</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ups_psrn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/baldur/man/psrn.html" class="external-link">psrn</a></span><span class="op">(</span><span class="va">ups</span>, <span class="st">'identifier'</span><span class="op">)</span></span>
<span><span class="va">ups_tmm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tmm.html">tmm</a></span><span class="op">(</span><span class="va">ups</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="gamma-regression-for-imputation-and-mean-variance-normalization">Gamma regression for imputation and mean-variance normalization<a class="anchor" aria-label="anchor" href="#gamma-regression-for-imputation-and-mean-variance-normalization"></a>
</h3>
<p>From here on out, several functions in <code>mavis</code> will depend
on a design matrix. A design matrix can be created as follows:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yeast_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span></span>
<span>  <span class="co"># Yeast has two conditions (1:2) and three replicates (each = 3)</span></span>
<span>  <span class="op">~</span><span class="fl">0</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, each <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">ups_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span></span>
<span>  <span class="co"># ups has three conditions (1:3) and four replicates (each = 4)</span></span>
<span>  <span class="op">~</span><span class="fl">0</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, each <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># The design matrices has to have the same name as the conditions:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">yeast_design</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'ng'</span>,   <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">ups_design</span><span class="op">)</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'fmol'</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Next, we will calculate the M-V trend and determine the integration
windows for the trend partitioning.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yeast_grid</span> <span class="op">&lt;-</span> <span class="va">yeast_psrn</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/calculate_mean_sd_trends.html">calculate_mean_sd_trends</a></span><span class="op">(</span><span class="va">yeast_design</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/grid_search.html">grid_search</a></span><span class="op">(</span><span class="va">yeast_design</span>, n_h1 <span class="op">=</span> <span class="fl">20</span>, n_h2 <span class="op">=</span> <span class="fl">20</span>, workers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu">parallel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="yeast_grid-1.png" alt="plot of chunk yeast_grid"><div class="figcaption">plot of chunk yeast_grid</div>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yeast_grid</span></span>
<span><span class="co">#&gt; # A tibble: 400 × 5</span></span>
<span><span class="co">#&gt;         h1      h2 formula       s clustered_data         </span></span>
<span><span class="co">#&gt;      &lt;dbl&gt;   &lt;dbl&gt; &lt;list&gt;    &lt;dbl&gt; &lt;list&gt;                 </span></span>
<span><span class="co">#&gt;  1 0.00782 0.213   &lt;formula&gt;  426. &lt;spc_tbl_ [2,235 × 11]&gt;</span></span>
<span><span class="co">#&gt;  2 0.110   0.213   &lt;formula&gt;  397. &lt;spc_tbl_ [2,235 × 11]&gt;</span></span>
<span><span class="co">#&gt;  3 0.00782 0.315   &lt;formula&gt;  374. &lt;spc_tbl_ [2,235 × 11]&gt;</span></span>
<span><span class="co">#&gt;  4 0.00782 0.418   &lt;formula&gt;  365. &lt;spc_tbl_ [2,235 × 11]&gt;</span></span>
<span><span class="co">#&gt;  5 0.213   0.315   &lt;formula&gt;  341. &lt;spc_tbl_ [2,235 × 11]&gt;</span></span>
<span><span class="co">#&gt;  6 0.00782 0.00782 &lt;formula&gt;  332. &lt;spc_tbl_ [2,235 × 11]&gt;</span></span>
<span><span class="co">#&gt;  7 0.00782 0.110   &lt;formula&gt;  331. &lt;spc_tbl_ [2,235 × 11]&gt;</span></span>
<span><span class="co">#&gt;  8 0.110   0.00782 &lt;formula&gt;  330. &lt;spc_tbl_ [2,235 × 11]&gt;</span></span>
<span><span class="co">#&gt;  9 0.110   0.520   &lt;formula&gt;  328. &lt;spc_tbl_ [2,235 × 11]&gt;</span></span>
<span><span class="co">#&gt; 10 0.110   0.418   &lt;formula&gt;  322. &lt;spc_tbl_ [2,235 × 11]&gt;</span></span>
<span><span class="co">#&gt; # ℹ 390 more rows</span></span>
<span><span class="co"># Select the best dataset</span></span>
<span><span class="va">yeast_psrn</span> <span class="op">&lt;-</span> <span class="va">yeast_grid</span><span class="op">$</span><span class="va">clustered_data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p>The gamma regression and mean-variance scatter plots can then be
produced by <code>plot_gamma_regression</code>.
<code>plot_gamma_regression</code> plots the trends used for precision
weights (later fed to <code>limma</code>’s <code>lmFit</code> similar to
<code>voom</code>) on the left and gamma regression after trend
partitioning on right. For <code>yeast</code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plt_gam.html">plot_gamma_regression</a></span><span class="op">(</span><span class="va">yeast_psrn</span>, <span class="va">yeast_design</span>, formula <span class="op">=</span> <span class="va">sd</span> <span class="op">~</span> <span class="va">mean</span> <span class="op">+</span> <span class="va">c</span><span class="op">)</span></span></code></pre></div>
<p><img src="gam_yeast-1.png" alt="plot of chunk gam_yeast"> The two
individual plots can be generated similarly by calling
<code>plot_gamma</code> or <code>plot_gamma_partition</code>. If one
wants to inspect the estimated models that can be done similarly with
<code>fit_gamma_regression</code>.</p>
</div>
<div class="section level3">
<h3 id="data-imputation-and-significance-calling">Data imputation and significance calling<a class="anchor" aria-label="anchor" href="#data-imputation-and-significance-calling"></a>
</h3>
<div class="section level4">
<h4 id="multiple-imputation">Multiple imputation<a class="anchor" aria-label="anchor" href="#multiple-imputation"></a>
</h4>
<p>To perform multiple imputations and then run limma on each imputation
can efficiently be performed by
<code>multiple_imputation_and_limma</code>.
<code>multiple_imputation_and_limma</code> fits the needed gamma
regressions and has a backend to <code>multidplyr</code> for parallel
processing. This can drastically increase the speed when running 1000 or
more imputations. Here is an example of the <code>yeast</code> data
running 1000 imputations and using 5 parallel workers. First, we need to
generate a contrast matrix that indicates what comparisons to
perform.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yeast_contrast</span> <span class="op">&lt;-</span> <span class="fu">limma</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/limma/man/makeContrasts.html" class="external-link">makeContrasts</a></span><span class="op">(</span></span>
<span>  contrasts <span class="op">=</span> <span class="st">'ng100-ng50'</span>,</span>
<span>  levels <span class="op">=</span> <span class="va">yeast_design</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This performs the test if the mean of the cysteines in the
<code>ng100</code> conditions is different from the means in the
<code>ng50</code> condition. Further, it also means that the LFC will be
calculated as <code>ng100 - ng50</code>. We are now ready to run the
imputation.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yeast_multi_imputation_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/multiple_imputation_and_limma.html">multiple_imputation_and_limma</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">yeast_psrn</span>,</span>
<span>  design <span class="op">=</span> <span class="va">yeast_design</span>,</span>
<span>  contrast_matrix <span class="op">=</span> <span class="va">yeast_contrast</span>,</span>
<span>  imputations <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  workers <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  id_col <span class="op">=</span> <span class="st">'identifier'</span>,</span>
<span>  plot_trend <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># we have already looked at the mean-variance plots</span></span>
<span>                      <span class="co"># otherwise, putting this flag to TRUE would generate those plots</span></span>
<span>  formula_imputation <span class="op">=</span> <span class="va">sd_p</span> <span class="op">~</span> <span class="va">mean</span> <span class="co"># Use the partitioned data for imputation</span></span>
<span>                                       <span class="co"># c is the name of the column containing the partitions</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimating Imputation Paramters</span></span>
<span><span class="co">#&gt; Previous error: Inf  &gt;   Current error: 5.444341 </span></span>
<span><span class="co">#&gt; Iteration time:</span></span>
<span><span class="co">#&gt;  5.971423 secs </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Previous error: 5.444341     &gt;   Current error: 0.1079685 </span></span>
<span><span class="co">#&gt; Iteration time:</span></span>
<span><span class="co">#&gt;  6.06436 secs </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Previous error: 0.1079685    &gt;   Current error: 0.04645285 </span></span>
<span><span class="co">#&gt; Iteration time:</span></span>
<span><span class="co">#&gt;  6.040693 secs </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Previous error: 0.04645285   &gt;   Current error: 0.02983121 </span></span>
<span><span class="co">#&gt; Iteration time:</span></span>
<span><span class="co">#&gt;  6.012253 secs </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Previous error: 0.02983121   &gt;   Current error: 0.02238201 </span></span>
<span><span class="co">#&gt; Iteration time:</span></span>
<span><span class="co">#&gt;  6.014209 secs </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Previous error: 0.02238201   &gt;   Current error: 0.01713396 </span></span>
<span><span class="co">#&gt; Iteration time:</span></span>
<span><span class="co">#&gt;  5.985145 secs </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Previous error: 0.01713396   &gt;   Current error: 0.01268942 </span></span>
<span><span class="co">#&gt; Iteration time:</span></span>
<span><span class="co">#&gt;  5.984343 secs </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Previous error: 0.01268942   &gt;   Current error: 0.009054756 </span></span>
<span><span class="co">#&gt; Iteration time:</span></span>
<span><span class="co">#&gt;  5.980093 secs </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Previous error: 0.009054756  &gt;   Current error: 0.007237367 </span></span>
<span><span class="co">#&gt; Iteration time:</span></span>
<span><span class="co">#&gt;  6.003131 secs </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Previous error: 0.007237367  &gt;   Current error: 0.007167067 </span></span>
<span><span class="co">#&gt; Iteration time:</span></span>
<span><span class="co">#&gt;  5.988187 secs </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Previous error: 0.007167067  &lt;   Current error: 0.00921588   Breaking </span></span>
<span><span class="co">#&gt; Iteration time:</span></span>
<span><span class="co">#&gt;  5.993181 secs</span></span></code></pre></div>
<p><code>yeast_multi_imputation_results</code> will now be a
<code>tibble</code> with each row containing one imputation and one
decision from limma.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yeast_multi_imputation_results</span></span>
<span><span class="co">#&gt; # A tibble: 20 × 3</span></span>
<span><span class="co">#&gt;    imputation imputed_data            limma_results       </span></span>
<span><span class="co">#&gt;         &lt;int&gt; &lt;list&gt;                  &lt;list&gt;              </span></span>
<span><span class="co">#&gt;  1          1 &lt;spc_tbl_ [2,235 × 11]&gt; &lt;tibble [2,235 × 5]&gt;</span></span>
<span><span class="co">#&gt;  2          2 &lt;spc_tbl_ [2,235 × 11]&gt; &lt;tibble [2,235 × 5]&gt;</span></span>
<span><span class="co">#&gt;  3          3 &lt;spc_tbl_ [2,235 × 11]&gt; &lt;tibble [2,235 × 5]&gt;</span></span>
<span><span class="co">#&gt;  4          4 &lt;spc_tbl_ [2,235 × 11]&gt; &lt;tibble [2,235 × 5]&gt;</span></span>
<span><span class="co">#&gt;  5          5 &lt;spc_tbl_ [2,235 × 11]&gt; &lt;tibble [2,235 × 5]&gt;</span></span>
<span><span class="co">#&gt;  6          6 &lt;spc_tbl_ [2,235 × 11]&gt; &lt;tibble [2,235 × 5]&gt;</span></span>
<span><span class="co">#&gt;  7          7 &lt;spc_tbl_ [2,235 × 11]&gt; &lt;tibble [2,235 × 5]&gt;</span></span>
<span><span class="co">#&gt;  8          8 &lt;spc_tbl_ [2,235 × 11]&gt; &lt;tibble [2,235 × 5]&gt;</span></span>
<span><span class="co">#&gt;  9          9 &lt;spc_tbl_ [2,235 × 11]&gt; &lt;tibble [2,235 × 5]&gt;</span></span>
<span><span class="co">#&gt; 10         10 &lt;spc_tbl_ [2,235 × 11]&gt; &lt;tibble [2,235 × 5]&gt;</span></span>
<span><span class="co">#&gt; 11         11 &lt;spc_tbl_ [2,235 × 11]&gt; &lt;tibble [2,235 × 5]&gt;</span></span>
<span><span class="co">#&gt; 12         12 &lt;spc_tbl_ [2,235 × 11]&gt; &lt;tibble [2,235 × 5]&gt;</span></span>
<span><span class="co">#&gt; 13         13 &lt;spc_tbl_ [2,235 × 11]&gt; &lt;tibble [2,235 × 5]&gt;</span></span>
<span><span class="co">#&gt; 14         14 &lt;spc_tbl_ [2,235 × 11]&gt; &lt;tibble [2,235 × 5]&gt;</span></span>
<span><span class="co">#&gt; 15         15 &lt;spc_tbl_ [2,235 × 11]&gt; &lt;tibble [2,235 × 5]&gt;</span></span>
<span><span class="co">#&gt; 16         16 &lt;spc_tbl_ [2,235 × 11]&gt; &lt;tibble [2,235 × 5]&gt;</span></span>
<span><span class="co">#&gt; 17         17 &lt;spc_tbl_ [2,235 × 11]&gt; &lt;tibble [2,235 × 5]&gt;</span></span>
<span><span class="co">#&gt; 18         18 &lt;spc_tbl_ [2,235 × 11]&gt; &lt;tibble [2,235 × 5]&gt;</span></span>
<span><span class="co">#&gt; 19         19 &lt;spc_tbl_ [2,235 × 11]&gt; &lt;tibble [2,235 × 5]&gt;</span></span>
<span><span class="co">#&gt; 20         20 &lt;spc_tbl_ [2,235 × 11]&gt; &lt;tibble [2,235 × 5]&gt;</span></span></code></pre></div>
<p>If one wants to access one particular imputation or decision that can
be done with <code>$</code> and <code>[[</code> as follows.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yeast_multi_imputation_results</span><span class="op">$</span><span class="va">imputed_data</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; # A tibble: 2,235 × 11</span></span>
<span><span class="co">#&gt;    identifier                              ng50_1 ng50_2 ng50_3 ng100_1 ng100_2 ng100_3  mean    sd c       sd_p</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                                    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1 Cre01.g000450.t1.2|PACid:30788617|--321   6.29  6.29    6.36    3.42    2.53    3.47  4.98 1.86  c     0.364 </span></span>
<span><span class="co">#&gt;  2 Cre01.g000800.t1.2|PACid:30788536|--66    7.97  8.00    8.05    7.74    7.78    7.78  7.88 0.134 a     0.0328</span></span>
<span><span class="co">#&gt;  3 Cre01.g002050.t1.1|PACid:30789101|--408   5.93  5.44    6.24    6.97    6.77    6.82  6.36 0.601 b     0.295 </span></span>
<span><span class="co">#&gt;  4 Cre01.g002300.t1.2|PACid:30788660|--168   6.53  6.23    5.89    6.52    6.45    6.19  6.30 0.246 a     0.254 </span></span>
<span><span class="co">#&gt;  5 Cre01.g002300.t1.2|PACid:30788660|--40    9.89 10.1     9.96   10.1    10.4    10.3  10.1  0.192 a     0.121 </span></span>
<span><span class="co">#&gt;  6 Cre01.g002300.t1.2|PACid:30788660|--69    9.09  8.88    8.64   10.0    10.1    10.0   9.46 0.665 b     0.162 </span></span>
<span><span class="co">#&gt;  7 Cre01.g004350.t1.2|PACid:30788641|--148   6.52  6.78    6.25    6.82    6.51    6.27  6.53 0.241 a     0.269 </span></span>
<span><span class="co">#&gt;  8 Cre01.g004500.t1.2|PACid:30789545|--270   1.85  0.697   1.72    6.55    6.74    6.27  5.35 2.34  c     0.234 </span></span>
<span><span class="co">#&gt;  9 Cre01.g004500.t1.2|PACid:30789545|--355  12.1  12.1    12.1    11.9    11.8    11.8  11.9  0.155 a     0.0346</span></span>
<span><span class="co">#&gt; 10 Cre01.g004500.t1.2|PACid:30789545|--402   8.10  6.95    5.11    9.54    9.59    9.55  8.14 1.83  c     1.07  </span></span>
<span><span class="co">#&gt; # ℹ 2,225 more rows</span></span>
<span><span class="va">yeast_multi_imputation_results</span><span class="op">$</span><span class="va">limma_results</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; # A tibble: 2,235 × 5</span></span>
<span><span class="co">#&gt;    identifier                                  lfc  mean    p_val comparison   </span></span>
<span><span class="co">#&gt;    &lt;chr&gt;                                     &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;        </span></span>
<span><span class="co">#&gt;  1 Cre06.g263450.t1.2|PACid:30779125|--303    3.53 12.1  7.22e-10 ng100 vs ng50</span></span>
<span><span class="co">#&gt;  2 sp|P00549|KPYK1_YEAST--418                 3.16 13.4  1.46e- 9 ng100 vs ng50</span></span>
<span><span class="co">#&gt;  3 Cre02.g114600.t1.2|PACid:30784840|--172    2.16 12.4  3.96e- 9 ng100 vs ng50</span></span>
<span><span class="co">#&gt;  4 gi|41179066|ref|NP_958423.1|--48-51-54-58  2.38 12.6  4.17e- 9 ng100 vs ng50</span></span>
<span><span class="co">#&gt;  5 Cre09.g386650.t1.2|PACid:30781165|--257    2.07 12.1  8.15e- 9 ng100 vs ng50</span></span>
<span><span class="co">#&gt;  6 Cre10.g420750.t1.2|PACid:30790763|--50-53  4.16  9.47 3.19e- 9 ng100 vs ng50</span></span>
<span><span class="co">#&gt;  7 Cre02.g120150.t1.2|PACid:30786468|--128    1.80 12.6  1.18e- 8 ng100 vs ng50</span></span>
<span><span class="co">#&gt;  8 Cre03.g182551.t1.2|PACid:30787991|--130    1.07 14.8  1.19e- 8 ng100 vs ng50</span></span>
<span><span class="co">#&gt;  9 sp|P05759|RS27A_YEAST--121-126             1.76 11.8  1.80e- 8 ng100 vs ng50</span></span>
<span><span class="co">#&gt; 10 sp|P00358|G3P2_YEAST--150                  1.06 12.1  2.39e- 8 ng100 vs ng50</span></span>
<span><span class="co">#&gt; # ℹ 2,225 more rows</span></span></code></pre></div>
<p>which shows the results of the fifth imputation. Next to perform
p-value correction and binomial testing for the imputations we use
<code>extract_results</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yeast_reduced_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extract_results.html">extract_results</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">yeast_psrn</span>,</span>
<span>  results <span class="op">=</span> <span class="va">yeast_multi_imputation_results</span>,</span>
<span>  id_col <span class="op">=</span> <span class="st">'identifier'</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  abs_lfc <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  pcor <span class="op">=</span> <span class="st">'fdr'</span>,</span>
<span>  null_hyp <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="single-imputation">Single imputation<a class="anchor" aria-label="anchor" href="#single-imputation"></a>
</h4>
<p>To perform a single imputation one can use the
<code>single_imputation</code> function. First we fit the gamma
regression to estimate the variance for the imputation model then we
perform the imputation:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yeast_psrn</span> <span class="op">&lt;-</span> <span class="va">yeast_psrn</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Add mean-variance trends</span></span>
<span>  <span class="fu"><a href="../reference/calculate_mean_sd_trends.html">calculate_mean_sd_trends</a></span><span class="op">(</span><span class="va">yeast_design</span><span class="op">)</span></span>
<span><span class="va">yeast_one_imputation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/imp.html">single_imputation</a></span><span class="op">(</span><span class="va">yeast_psrn</span>, <span class="va">yeast_design</span>, <span class="va">sd_p</span> <span class="op">~</span> <span class="va">mean</span><span class="op">)</span></span>
<span><span class="co">#&gt; Estimating Imputation Paramters</span></span>
<span><span class="co">#&gt; Previous error: Inf  &gt;   Current error: 5.458818 </span></span>
<span><span class="co">#&gt; Iteration time:</span></span>
<span><span class="co">#&gt;  5.891357 secs </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Previous error: 5.458818     &gt;   Current error: 0.1134419 </span></span>
<span><span class="co">#&gt; Iteration time:</span></span>
<span><span class="co">#&gt;  5.978635 secs </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Previous error: 0.1134419    &gt;   Current error: 0.04493073 </span></span>
<span><span class="co">#&gt; Iteration time:</span></span>
<span><span class="co">#&gt;  5.966029 secs </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Previous error: 0.04493073   &gt;   Current error: 0.030459 </span></span>
<span><span class="co">#&gt; Iteration time:</span></span>
<span><span class="co">#&gt;  5.963692 secs </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Previous error: 0.030459     &gt;   Current error: 0.02016536 </span></span>
<span><span class="co">#&gt; Iteration time:</span></span>
<span><span class="co">#&gt;  5.958513 secs </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Previous error: 0.02016536   &gt;   Current error: 0.01278651 </span></span>
<span><span class="co">#&gt; Iteration time:</span></span>
<span><span class="co">#&gt;  5.96677 secs </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Previous error: 0.01278651   &gt;   Current error: 0.008127496 </span></span>
<span><span class="co">#&gt; Iteration time:</span></span>
<span><span class="co">#&gt;  5.963759 secs </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Previous error: 0.008127496  &gt;   Current error: 0.005392598 </span></span>
<span><span class="co">#&gt; Iteration time:</span></span>
<span><span class="co">#&gt;  5.985986 secs </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Previous error: 0.005392598  &lt;   Current error: 0.006126771  Breaking </span></span>
<span><span class="co">#&gt; Iteration time:</span></span>
<span><span class="co">#&gt;  5.952502 secs</span></span></code></pre></div>
<p>Next, we fit the gamma regression for estimating the precision
weights with <code>fit_gamma_weights</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yeast_gam_reg</span> <span class="op">&lt;-</span> <span class="va">yeast_one_imputation</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Update mean-variance post imputation</span></span>
<span>  <span class="fu"><a href="../reference/calculate_mean_sd_trends.html">calculate_mean_sd_trends</a></span><span class="op">(</span><span class="va">yeast_design</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># Fit the regression</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/baldur/man/fit_gamma_regression.html" class="external-link">fit_gamma_regression</a></span><span class="op">(</span><span class="va">sd</span> <span class="op">~</span> <span class="va">mean</span><span class="op">)</span></span></code></pre></div>
<p>We now run a single instance of <code>limma</code> with
<code>run_limma</code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yeast_one_imputation_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_limma.html">run_limma</a></span><span class="op">(</span></span>
<span>  <span class="va">yeast_one_imputation</span>,</span>
<span>  <span class="va">yeast_design</span>,</span>
<span>  <span class="va">yeast_contrast</span>,</span>
<span>  <span class="va">yeast_gam_reg</span>,</span>
<span>  <span class="st">'identifier'</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>One might want to perform some p-value correction on this data. This
can be one with <code>R</code>’s function <code>p.adjust</code>.
Further, since <code>run_limma</code> returns the data in tidy format
and if there are several comparisons, <code>dplyr</code>’s
<code>group_by</code> and <code>mutate</code> can perform p-value
correction per comparison as follows:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yeast_one_imputation_results</span> <span class="op">&lt;-</span> <span class="va">yeast_one_imputation_results</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">comparison</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    p_val <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust</a></span><span class="op">(</span><span class="va">p_val</span>, <span class="st">'fdr'</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="plotting-the-results">Plotting the results<a class="anchor" aria-label="anchor" href="#plotting-the-results"></a>
</h3>
<div class="section level4">
<h4 id="multiple-imputation-1">Multiple imputation<a class="anchor" aria-label="anchor" href="#multiple-imputation-1"></a>
</h4>
<p>The final decision for the analysis can be plotted with
<code>plot_ma</code>. <code>plot_ma</code> returns a <code>ggplot</code>
object so it can easily be ascetically adjusted using
<code>ggplot</code> syntax.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_ma.html">plot_ma</a></span><span class="op">(</span><span class="va">yeast_reduced_results</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># Move legend to below the plot</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">'bottom'</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="yeast_mult_ma-1.png" alt="plot of chunk yeast_mult_ma"><div class="figcaption">plot of chunk yeast_mult_ma</div>
</div>
</div>
<div class="section level4">
<h4 id="single-imputation-1">Single imputation<a class="anchor" aria-label="anchor" href="#single-imputation-1"></a>
</h4>
<p>For the single imputation, we need to include a few more inputs to
<code>plot_ma</code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_ma.html">plot_ma</a></span><span class="op">(</span></span>
<span>  hits <span class="op">=</span> <span class="va">yeast_one_imputation_results</span>,</span>
<span>  data <span class="op">=</span> <span class="va">yeast_one_imputation</span>,</span>
<span>  id_col <span class="op">=</span> <span class="st">'identifier'</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">.05</span>,</span>
<span>  abs_lfc <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span> <span class="op">+</span> <span class="co"># Set color-blind friendly colors</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'grey45'</span>, <span class="st">'darkblue'</span>, <span class="st">'darkred'</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="float">
<img src="yeast_one_ma-1.png" alt="plot of chunk yeast_one_ma"><div class="figcaption">plot of chunk yeast_one_ma</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Philip Berg.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.8.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
